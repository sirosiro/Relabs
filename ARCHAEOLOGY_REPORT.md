# Archaeology Report for Relabs

## 1. 概要 (Overview)
プロジェクト `Relabs` に対するアーキテクチャ再発掘（Archaeology）が完了しました。
既存のソースコードを詳細に解析し、隠れていた設計意図（Intent）や重要なトレードオフ判断を抽出し、各ディレクトリの `ARCHITECTURE_MANIFEST.md` に明文化しました。

これにより、AIと人間が共通の理解を持って開発を進めるための強固な基盤が整いました。

## 2. 発見された重要なアーキテクチャ決定 (Key Architectural Discoveries)

今回の発掘で、以下の「コードには書かれているが、ドキュメント化されていなかった重要な判断」が明らかになりました。

### Core Module
*   **通知ストームの回避**: `Model.translate_all` メソッドにおいて、パフォーマンスを優先して `Vertex` のカプセル化を意図的に破り、直接フィールド書き換えを行っていることが判明しました。これは正当な最適化としてマニフェストに記録されました。
*   **データ構造の制約**: `Face` オブジェクト間で頂点が共有されていない（Polygon Soup構造である）ことが確認されました。

### Service Module
*   **オンデマンド座標変換**: モデルデータは常に「絶対座標」で保持され、「相対座標」への変換は `Exporter` がファイル出力時に一時的に行っていることが確認されました。これによりモデルの純粋性が保たれています。

### UI Module
*   **無限ループ防止ガード**: `ControlPanel` において、`_updating_ui` フラグを用いて「Model更新 -> UI更新 -> イベント発火 -> Model更新...」という循環参照を防ぐ実装パターンが発見されました。
*   **高DPI対応**: `Viewport` において、論理ピクセル（マウス座標）と物理ピクセル（OpenGL座標）の変換ロジックが実装されていることが確認されました。

## 3. マニフェスト更新ハイライト (Manifest Highlights)

| モジュール | 更新内容 |
| :--- | :--- |
| **Root** | `tests` モジュールへの参照追加、全体的なリスク管理指針の明記。 |
| **Core** | `Observable` の循環参照リスクへの警告、`Face` のイベントバブリング仕様の明記。 |
| **Service** | `Exporter` のステートレス性、`SelectionManager` のMediatorとしての役割定義。 |
| **UI** | メインスレッド制約、Qtシグナルによる疎結合設計の強調。 |
| **Tests** | **[新規作成]** UIテストを行わず、Coreロジックの検証に集中する戦略の定義。 |

## 4. 今後の推奨アクション (Recommended Next Steps)

1.  **インテント・コメントの適用**:
    *   今回の解析で明らかになった設計意図（`@intent:rationale` や `@intent:responsibility`）を、実際のソースコード上のコメントとして追記していくことを推奨します。これにより、コードを読むだけで設計意図が伝わるようになります。

2.  **テストカバレッジの向上**:
    *   `tests` マニフェストの方針に従い、`Core/geometry_utils.py` の交差判定ロジックなど、未テストの領域に対するユニットテストを追加することを推奨します。

---
Report generated by AI Architect on 2026-02-04
